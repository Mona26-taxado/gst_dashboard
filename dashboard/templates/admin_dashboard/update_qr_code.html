{% extends 'base.html' %}
{% load static %}

{% block title %}Update QR Code{% endblock %}

{% block content %}
<div class="page-header">
    <h3 class="page-title">Update QR Code & UPI ID</h3>
</div>

<div class="row">
    <div class="col-12 grid-margin stretch-card">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title">Update QR Code for All Users</h4>
                <p class="card-description">
                    Upload a new QR code image and update UPI ID. This will automatically update QR codes for all Retailers, Distributors, and Master Distributors.
                </p>
                
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                    {% endfor %}
                {% endif %}

                <form method="POST" enctype="multipart/form-data" class="forms-sample">
                    {% csrf_token %}
                    
                    <div class="form-group">
                        <label for="qr_code_image">QR Code Image</label>
                        <input type="file" class="form-control-file" id="qr_code_image" name="qr_code_image" accept="image/*">
                        <small class="form-text text-muted">Upload a new QR code image (PNG, JPG, etc.)</small>
                        
                        {% if qr_settings.qr_code_image %}
                            <div class="mt-3">
                                <p><strong>Current QR Code:</strong></p>
                                <img src="{{ qr_settings.qr_code_image.url }}" alt="Current QR Code" class="img-thumbnail" style="max-width: 300px; max-height: 300px;">
                            </div>
                        {% endif %}
                    </div>

                    <div class="form-group">
                        <label for="upi_id">UPI ID</label>
                        <input type="text" class="form-control" id="upi_id" name="upi_id" value="{{ qr_settings.upi_id }}" placeholder="Enter UPI ID (e.g., 9336323478@okbizaxis)" required>
                        <small class="form-text text-muted">This UPI ID will be used for all users when generating QR codes</small>
                    </div>

                    {% if qr_settings.updated_at %}
                    <div class="form-group">
                        <small class="text-muted">
                            Last updated: {{ qr_settings.updated_at|date:"d M Y, h:i A" }}
                            {% if qr_settings.updated_by %}
                                by {{ qr_settings.updated_by.full_name }}
                            {% endif %}
                        </small>
                    </div>
                    {% endif %}

                    <button type="submit" class="btn btn-primary mr-2">Update QR Code & UPI</button>
                    <a href="{% url 'admin_dashboard' %}" class="btn btn-light">Cancel</a>
                </form>

                <div class="mt-4">
                    <div class="alert alert-info">
                        <h5>Note:</h5>
                        <ul>
                            <li>When you update the QR code, it will automatically update for all <strong>Retailers</strong>, <strong>Distributors</strong>, and <strong>Master Distributors</strong></li>
                            <li>The UPI ID will be used to generate new QR codes for all users</li>
                            <li>Old QR code files will be automatically deleted when a new one is uploaded</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
